{{/* Generate monitor grafana envs */}}
{{- define "grafana.envs" }}
env:
{{- if eq .Values.global.influxdb_location "off-cluster" }}
- name: "INFLUXDB_URL"
  valueFrom:
    secretKeyRef:
      name: influxdb-creds
      key: url
{{- else }}
- name: "INFLUXDB_URL"
  value: http://$(DRYCC_INFLUXDB_SERVICE_HOST):$(DRYCC_INFLUXDB_SERVICE_PORT_TRANSPORT)
{{- end }}
- name: "INFLUXDB_BUCKET"
  valueFrom:
    secretKeyRef:
      name: influxdb-creds
      key: bucket
- name: "INFLUXDB_ORG"
  valueFrom:
    secretKeyRef:
      name: influxdb-creds
      key: org
- name: "INFLUXDB_TOKEN"
  valueFrom:
    secretKeyRef:
      name: influxdb-creds
      key: token
- name: "BIND_PORT"
  value: "3000"
- name: "DEFAULT_USER"
  value: {{.Values.grafana.user}}
- name: "DEFAULT_USER_PASSWORD"
  value: {{.Values.grafana.password}}
- name: "KUBERNETES_CLUSTER_DOMAIN"
  value: {{.Values.global.cluster_domain}}
{{- range $key, $value := .Values.grafana.environment }}
- name: {{ $key }}
  value: {{ $value | quote }}
{{- end }}
- name: "DRYCC_GRAFANA_DOMAIN"
  value: http://drycc-monitor-grafana.{{ .Values.global.platform_domain }}
- name: "DRYCC_PASSPORT_DOMAIN"
  value: http://drycc-passport.{{ .Values.global.platform_domain }}
- name: "SOCIAL_AUTH_DRYCC_AUTHORIZATION_URL"
  value: "$(DRYCC_PASSPORT_DOMAIN)/oauth/authorize/"
- name: "SOCIAL_AUTH_DRYCC_ACCESS_TOKEN_URL"
  value: "$(DRYCC_PASSPORT_DOMAIN)/oauth/token/"
- name: "SOCIAL_AUTH_DRYCC_ACCESS_API_URL"
  value: "$(DRYCC_PASSPORT_DOMAIN)"
- name: "SOCIAL_AUTH_DRYCC_USERINFO_URL"
  value: "$(DRYCC_PASSPORT_DOMAIN)/oauth/userinfo/"
- name: SOCIAL_AUTH_DRYCC_GRAFANA_KEY
  valueFrom:
    secretKeyRef:
      name: passport-creds
      key: social-auth-drycc-grafana-key
- name: SOCIAL_AUTH_DRYCC_GRAFANA_SECRET
  valueFrom:
    secretKeyRef:
      name: passport-creds
      key: social-auth-drycc-grafana-secret
{{- end }}
